---
title: "모던 웹 브라우저 살펴보기 _ 1탄"
date: "2023-02-25"
description: "Chrome Developers Blog: Inside look at modern web browser (part 1)"
tags: ["web", "browser", "cs"]
thumbnail: "thumbnail.png"
---

## CPU와 GPU

CPU(중앙 처리 장치)는 컴퓨터 시스템을 컨트롤하고 프로그램의 연산을 실행 및 처리하는 컴퓨터의 가장 핵심 제어 장치이다. CPU 내부에서 연산을 담당하는 ALU(연산 장치)는 구조가 매우 복잡하며, **복잡한 계산에 대한 빠른 처리가 가능하나, 이 모든 작업을 명령어가 입력된 순서대로 직렬 처리**한다.

GPU(그래픽 처리 장치)는 다수의 코어로 이루어져있고 CPU에 비해 ALU의 구조가 단순하며 제어 및 캐시 영역이 작다. 따라서 여러개의 코어를 **병렬로 작동시켜 부동 소수점 연산 등 특정 단순 계산 작업을 빠르게 처리**할 수 있다. 따라서 3D, 렌더링, 딥러닝 등 다량의 병렬 연산이 필요한 곳에 GPU가 사용되는 것이며 연산을 가속한다는 의미로 '가속기'라고 불리기도 한다.

!["cpu & gpu"](/images/posts/modern_web_browser_1/cpu_gpu.png)

컴퓨터에서 애플리케이션을 실행하면 CPU와 GPU가 애플리케이션을 구동시키며, 운영체제에서 제공하는 매커니즘을 바탕으로 실행된다.

## 프로세스와 스레드

프로세스는 메모리에 올라와 실행되고 있는 프로그램의 독립적인 개체이며, OS로 부터 시스템 자원을 할당받는 단위이다. 스레드는 이 프로세스 안에서 실행되는 흐름의 단위를 말한다. 프로세스는 최소 하나의 스레드를 보유하고 있으며, 각각 별도의 주소 공간을 독립적으로 할당받는다. Code, Data, Stack, Heap 공간 중 Stack만 따로 할당받고 나머지 영역은 스레드끼리 공유하여 사용한다.
응용 프로그램을 닫으면 프로세스가 사라지면서 운영체제의 메모리가 확보된다.

!["process & thread"](/images/posts/modern_web_browser_1/process_thread.png)

프로세스 사이에 서로 데이터를 주고 받는 것을 IPC(Inter Process Communication)이라고 한다. 각 프로세스는 자신의 독립적인 메모리 공간을 가지고 보호하고 있기 때문에, 두 프로세스가 통신하기 위해서는 IPC가 필요하다.

## 브라우저 아키텍처

렌더러 프로세스는 탭 내부에서 발생하는 모든 작업을 담당하며, 여러 프로세스가 생성되어 각 탭에 할당된다. Chrome 브라우저의 경우에도 마찬가지로 각 탭에 iframe을 포함한 프로세스를 제공하고 있다.
Chrome의 다중 프로세스 아키텍쳐에서는 렌더러 프로세스 아래에 여러 레이어가 존재하여 각 탭에 대해 여러개의 렌더러 프로세스를 실행시킨다.

## 각 프로세스가 제어하는 것

!["process control"](/images/posts/modern_web_browser_1/process_control.png)

- **브라우저**: 주소 표시줄, 북마크, 앞/뒤로 이동 버튼 등을 포함한 어플리케이션의 "크롬" 부분을 담당한다. 또한 네트워크 요청 및 파일 액세스와 같은 웹 브라우저의 보이지 않는 권한을 처리한다.
- **렌더러**: 웹 사이트가 표시되는 탭 내부의 모든 것을 제어한다.
- **플러그인**: Flash와 같은 웹사이트 내부에서 사용되는 모든 플러그인을 제어한다.
- **GPU**: 다른 프로세스와 별도로 GPU 작업을 처리한다. GPU가 여러 어플리케이션의 요청을 처리하여 동일한 화면에 그리기 때문에 다른 프로세스로 분리된다.

## Chrome 다중 프로세스 아키텍쳐의 장점

Chrome은 다중 렌더러 프로세스를 이용하고 있기 때문에 **각 탭에 자체 렌더러 프로세스가 있다**라고 생각할 수 있다. 각 탭이 독립적인 프로세스에 의해 실행되기 때문에, 하나의 탭에서 에러가 나도 다른 탭은 영향 없이 정상적으로 작동하게 된다.

또 다른 장점은 Sandboxing이다. Sandboxing이란 외부 프로그램을 보호된 영역 내에서 프로그램을 작동시키는 것으로, 다른 파일이나 프로세스로 부터 분리되어 작동하기 때문에 시스템이 의도치 않게 조작되는 것을 방지한다. OS에서 프로세스의 권한을 제한하는 기능을 제공하여, 브라우저는 특정 기능에서 특정 프로세스를 샌드박싱 할 수 있다.

Chrome은 메모리를 절약하기 위해 가동할 수 있는 프로세스 수를 제한시킨다. 제한은 장치의 메모리 및 CPU 성능에 따라 다르지만, 제한에 도달하면 하나의 프로세스에서 동일한 사이트의 여러 탭을 실행한다.

## 메모리 절약 - Chrome의 서비스

브라우저 프로그램의 각 부분을 서비스로 실행하여 프로세스를 쉽게 분할하거나 합칠 수 있도록 아키텍쳐를 변경하고 있다. 성능이 좋은 하드웨어에서 실행될 때는 각 서비스를 다른 프로세스로 분할하여 안정성있게 작동시키고, 성능에 제한이 있는 하드웨어에서는 메모리 공간을 절약하는 하나의 프로세스로 서비스를 통합한다.

!["process operate diagram"](/images/posts/modern_web_browser_1/process_diagram.png)

## 프레임 별 렌더러 프로세스 - Site Isolation(격리)

Chrome에 최근 도입된 기능인 Site Isolation은 각 사이트의 iframe에 대하여 별도의 렌더러 프로세스를 실행하는 기능이다.
앞에서 한 탭 당 하나의 렌더러 프로세스가 할당된다고 했는데, 이는 각각 다른 사이트가 동일한 메모리 공간을 공유하면서 동작한다는 것을 의미한다.

동일 출처 정책(same origin policy)은 웹의 핵심 보안 모델로 한 사이트가 다른 사이트의 데이터에 동의 없이 접근할 수 없도록 하며, 보안 공격 시 주로 이 정책을 위반하는 방식을 사용한다. 따라서 각 프로세스를 독립하여 작동시킴으로써 site isolation을 유지하여 melt-down이나 spectre 같은 보안 취약점으로부터 보호해야 한다. Chrome67부터는 기본적으로 데스크톱에서 site isolation이 적용되어 있어 각 탭의 cross-site iframe은 별도의 렌더러 프로세스를 가져온다.

!["site-isolation"](/images/posts/modern_web_browser_1/site-isolation.png)

다른 프로세스에서 실행되고 있는 iframe이 있는 페이지에서 devtool을 연다면 devtool이 매끄럽게 작동하도록 별도의 백그라운드 작업이 필요하고,찾기 기능(ctrl+f)을 실행하는 것도 다른 렌더러 프로세스에서 작동하는 것을 의미한다. Site isolation을 구현하기 위해 엔지니어들의 많은 노력이 들었다.
